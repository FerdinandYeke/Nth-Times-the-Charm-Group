<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>Recipeté</title>

<style>
body { background:#faeddc;font-family:Arial;margin:0;padding:20px; }
#recipes,.view { margin-top:15px; }
.card{background:#ede0f0;padding:12px;border-radius:8px;margin-bottom:8px;cursor:pointer;}

#ingredientFilter{padding:8px;border-radius:6px;width:250px;border:2px solid #c69ae9;}

.panel{padding:10px;background:#ede0f0;border-radius:6px;display:none;}
.tabs button{padding:9px 16px;border:none;background:#d6b5ff;margin-right:4px;cursor:pointer;border-radius:6px;}
.tabs button.active{background:#b58af6;color:white;}
</style>
</head>

<body>

<h1>Recipeté Recipes</h1>
<input id="ingredientFilter" placeholder="Filter by ingredients...">
<button id="searchBtn">Search</button>

<div id="recipes"></div>

<!-- RECIPE VIEW -->
<div id="recipeView" style="display:none">

  <h2 id="rTitle"></h2>

  <div class="tabs">
    <button class="tab active" onclick="showTab('ing')">Ingredients</button>
    <button class="tab" onclick="showTab('inst')">Instructions</button>
  </div>

  <div id="ing" class="panel" style="display:block"></div>
  <div id="inst" class="panel"></div>

</div>

<script>
let all=[];

async function loadRecipes(){
  let r=await fetch("/api/recipes");
  all=await r.json();
  render(all);
}
function render(list){
  const box=document.getElementById("recipes");
  box.innerHTML="";
  list.forEach(r=>{
      let div=document.createElement("div");
      div.className="card";
      div.textContent=r.title;
      div.onclick=()=>openRecipe(r.recipe_id);
      box.appendChild(div);
  });
}
async function openRecipe(id){
  const r=await (await fetch("/api/recipes/"+id)).json();

  document.getElementById("recipeView").style.display="block";
  document.getElementById("rTitle").textContent=r.title;

  document.getElementById("ing").innerHTML=
    r.ingredients.length? r.ingredients.map(i=>`• ${i.ingredient_name} (${i.note||""})`).join("<br>")
    : "No ingredients listed";

  document.getElementById("inst").innerHTML=
    r.description? r.description.replace(/\n+/g,"<br><br>")
    : "No instructions available";
}

document.getElementById("searchBtn").onclick=()=>{
  let q=document.getElementById("ingredientFilter").value.toLowerCase()
      .split(",").map(x=>x.trim()).filter(x=>x);

  if(q.length==0) return render(all);

  render(all.filter(r=>
    q.every(ing=> (r.description||"").toLowerCase().includes(ing))
  ));
};

function showTab(tab){
  document.querySelectorAll(".panel").forEach(e=>e.style.display="none");
  document.getElementById(tab).style.display="block";
  document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
  event.target.classList.add("active");
}

loadRecipes();
</script>
</body>
</html>
